<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Survey Visualization</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5dc; /* Beige background */
        }

        #filters {
            margin-bottom: 20px;
            padding: 10px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        #coffeeTypeImages {
            margin-top: 10px;
        }

        .coffee-type-filter {
            display: inline-block;
            margin: 5px;
            cursor: pointer;
        }

        .coffee-type-filter img {
            width: 30px;
            height: 30px;
        }

        .rounded-button {
            border-radius: 10px;
            padding: 5px 10px;
            border: none;
            background-color: #e0e0e0;
            cursor: pointer;
        }

        .view-by-button {
            border-radius: 10px;
            padding: 5px 10px;
            border: none;
            background-color: #e0e0e0;
            cursor: pointer;
            margin: 5px;
        }

        .view-by-button.active {
            background-color: #ccc;
        }

        #chart {
            width: 800px;
            height: 600px;
            margin: auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div id="filters">
        <div id="coffee-type-filters">
            <button id="selectAll" class="rounded-button">Select All</button>
            <button id="clearAll" class="rounded-button">Clear All</button>
            <!-- Placeholder for coffee type images -->
            <div id="coffeeTypeImages">
                <!-- Example: -->
                <div class="coffee-type-filter">
                    <img id="regularDrip" src="regular_drip.png" alt="Regular Drip">
                </div>
                <div class="coffee-type-filter">
                    <img id="pourover" src="pourover.png" alt="Pourover">
                </div>
                <div class="coffee-type-filter">
                    <img id="mocha" src="mocha.png" alt="Mocha">
                </div>
                <div class="coffee-type-filter">
                    <img id="latte" src="latte.png" alt="Latte">
                </div>
                <div class="coffee-type-filter">
                    <img id="icedCoffee" src="iced_coffee.png" alt="Iced Coffee">
                </div>
                <div class="coffee-type-filter">
                    <img id="espresso" src="espresso.png" alt="Espresso">
                </div>
                <div class="coffee-type-filter">
                    <img id="cortado" src="cortado.png" alt="Cortado">
                </div>
                <div class="coffee-type-filter">
                    <img id="coldBrew" src="cold_brew.png" alt="Cold Brew">
                </div>
                <div class="coffee-type-filter">
                    <img id="cappuccino" src="cappuccino.png" alt="Cappuccino">
                </div>
                <div class="coffee-type-filter">
                    <img id="blendedDrink" src="blended_drink.png" alt="Blended Drink">
                </div>
                <div class="coffee-type-filter">
                    <img id="americano" src="americano.png" alt="Americano">
                </div>
                <div class="coffee-type-filter">
                    <img id="other" src="other.png" alt="Other">
                </div>
            </div>
        </div>
        <div id="viewByFilters">
            <button class="view-by-button" id="ageButton">Age</button>
            <button class="view-by-button" id="raceButton">Race</button>
            <button class="view-by-button" id="genderButton">Gender</button>
        </div>
    </div>
    <div id="chart"></div>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        // Load data
        d3.csv('coffee_survey.csv').then(data => {
            // Process data for visualization
            const ageGroups = ['<18', '18-24', '25-34', '35-44', '45-54', '55-64', '>65'];
            const coffeeTypes = ['Regular Drip', 'Pourover', 'Mocha', 'Latte', 'Iced Coffee', 'Espresso', 'Cortado', 'Cold Brew', 'Cappuccino', 'Blended Drink', 'Americano', 'Other'];

            // Initialize selected coffee types
            let selectedCoffeeTypes = coffeeTypes.slice();
            let viewBy = 'age';

            // Function to update chart based on filters
            function updateChart() {
                const filteredData = data.filter(d => {
                    // Filter by selected coffee types
                    return selectedCoffeeTypes.includes(d.favorite);
                });

                // Group data by age group
                const groupedData = {};
                ageGroups.forEach(age => {
                    groupedData[age] = filteredData.filter(d => {
                        // Assuming age is in a column named 'age'
                        if (d.age === '<18') return age === '<18';
                        if (d.age === '>65') return age === '>65';
                        const ageRange = d.age.split('-');
                        return parseInt(ageRange[0]) >= parseInt(age.split('-')[0]) && parseInt(ageRange[1]) <= parseInt(age.split('-')[1]);
                    }).length;
                });

                // Draw bar chart
                const margin = { top: 20, right: 20, bottom: 30, left: 40 };
                const width = 800 - margin.left - margin.right;
                const height = 600 - margin.top - margin.bottom;

                const svg = d3.select('#chart')
                    .append('svg')
                    .attr('width', width + margin.left + margin.right)
                    .attr('height', height + margin.top + margin.bottom)
                    .append('g')
                    .attr('transform', `translate(${margin.left}, ${margin.top})`);

                const xScale = d3.scaleBand()
                    .domain(ageGroups)
                    .range([0, width])
                    .padding(0.2);

                const yScale = d3.scaleLinear()
                    .domain([0, d3.max(Object.values(groupedData))])
                    .range([height, 0]);

                svg.selectAll('rect')
                    .data(ageGroups)
                    .enter()
                    .append('rect')
                    .attr('x', d => xScale(d))
                    .attr('y', d => yScale(groupedData[d]))
                    .attr('width', xScale.bandwidth())
                    .attr('height', d => height - yScale(groupedData[d]));

                svg.append('g')
                    .attr('transform', `translate(0, ${height})`)
                    .call(d3.axisBottom(xScale));

                svg.append('g')
                    .call(d3.axisLeft(yScale));
            }

            // Event listeners for coffee type filters
            d3.selectAll('.coffee-type-filter')
                .on('click', function() {
                    const coffeeType = this.querySelector('img').alt;
                    if (selectedCoffeeTypes.includes(coffeeType)) {
                        selectedCoffeeTypes = selectedCoffeeTypes.filter(t => t !== coffeeType);
                        d3.select(this).classed('active', false);
                    } else {
                        selectedCoffeeTypes.push(coffeeType);
                        d3.select(this).classed('active', true);
                    }
                    updateChart();
                });

            // Initialize active state for all filters
            d3.selectAll('.coffee-type-filter')
                .each(function() {
                    const coffeeType = this.querySelector('img').alt;
                    if (selectedCoffeeTypes.includes(coffeeType)) {
                        d3.select(this).classed('active', true);
                    }
                });

            // Event listener for select all/clear all buttons
            d3.select('#selectAll')
                .on('click', () => {
                    selectedCoffeeTypes = coffeeTypes.slice();
                    d3.selectAll('.coffee-type-filter').classed('active', true);
                    updateChart();
                });

            d3.select('#clearAll')
                .on('click', () => {
                    selectedCoffeeTypes = [];
                    d3.selectAll('.coffee-type-filter').classed('active', false);
                    updateChart();
                });

            // Event listeners for view by filters
            d3.select('#ageButton')
                .on('click', () => {
                    viewBy = 'age';
                    d3.selectAll('.view-by-button').classed('active', false);
                    d3.select('#ageButton').classed('active', true);
                    updateChart();
                });

            d3.select('#raceButton')
                .on('click', () => {
                    viewBy = 'race';
                    d3.selectAll('.view-by-button').classed('active', false);
                    d3.select('#raceButton').classed('active', true);
                    // Implement logic to group by race
                    console.log('Group by race not implemented yet');
                });

            d3.select('#genderButton')
                .on('click', () => {
                    viewBy = 'gender';
                    d3.selectAll('.view-by-button').classed('active', false);
                    d3.select('#genderButton').classed('active', true);
                    // Implement logic to group by gender
                    console.log('Group by gender not implemented yet');
                });

            // Initial chart draw
            updateChart();
        });
    </script>
</body>
</html>
